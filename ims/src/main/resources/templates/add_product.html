<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title th:text="${pageTitle}"></title>
    <link rel="icon" type="image/png" sizes="16x16" th:href="@{/images/favicon.png}">
    <link th:href="@{/libs/fullcalendar/dist/fullcalendar.min.css}" rel="stylesheet" />
    <link th:href="@{/extra-libs/calendar/calendar.css}" rel="stylesheet" />
    <link th:href="@{/css/style.min.css}" rel="stylesheet">
    <style>
        .notification-box {
            position: fixed;
            top: 20px;
            right: 20px;
            background-color: #4CAF50;
            color: white;
            padding: 15px 20px;
            border-radius: 5px;
            font-size: 16px;
            display: none;
            z-index: 1000;
            box-shadow: 0px 4px 6px rgba(0, 0, 0, 0.1);
        }
    </style>
</head>
<body>

<div id="main-wrapper" data-layout="vertical" data-navbarbg="skin5" data-sidebartype="full"
     data-sidebar-position="absolute" data-header-position="absolute" data-boxed-layout="full">

    <div th:replace="header :: header"></div>

    <div class="notification-box" id="notification-box">
        Product added successfully!
    </div>

    <div class="page-wrapper">
        <div class="container-fluid">
            <h3 th:text="${pageTitle}"></h3>
            
            <form enctype="multipart/form-data" method="post" th:action="@{/products/save}">
                <div class="form-group">
                    <label for="product-name">Product Name</label>
                    <input type="text" id="product-name" name="product-name" class="form-control" placeholder="Enter product name">
                </div>
                <div class="form-group">
                    <label for="price">Price</label>
                    <input type="number" id="price" name="price" class="form-control" placeholder="Enter price">
                </div>
                <div class="form-group">
                    <label for="quantity">Quantity</label>
                    <input type="number" id="quantity" name="quantity" class="form-control" placeholder="Enter quantity">
                </div>
                <div class="form-group">
                    <label for="category-id">Category</label>
                    <select id="category-id" name="category-id" class="form-control">
                        <!-- Options to be populated via JavaScript -->
                    </select>
                </div>
                <div class="form-group">
                    <label for="product-image">Image</label>
                    <input type="file" id="product-image" name="product-image" class="form-control">
                </div>
                <button type="submit" class="btn btn-primary">Save Product</button>
            </form>
        </div>
    </div>

    <div th:replace="footer :: footer"></div>
</div>

<!-- Scripts -->
 <th:block th:replace="script :: script"></th:block>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.bundle.min.js"></script>

<script>
    $(document).ready(function () {
        // Show notification box
        function showNotification() {
            const notificationBox = $('#notification-box');
            notificationBox.fadeIn();

            // Hide the notification after 3 seconds
            setTimeout(() => notificationBox.fadeOut(), 3000);
        }

        // Populate categories dropdown
        function populateCategories() {
            $.ajax({
                url: '/get-category',
                type: 'GET',
                success: function (response) {
                    const categoryDropdown = $('select[name="category-id"]');
                    categoryDropdown.empty();
                    response.forEach(category => {
                        categoryDropdown.append(new Option(category.c_name, category.c_id));
                    });
                },
                error: function () {
                    alert('Error fetching categories.');
                }
            });
        }

        // Call function to populate categories on page load
        populateCategories();

        // Submit form to save product
        $('form').on('submit', function (event) {
            event.preventDefault();

            const formData = new FormData(this);
            const productData = {
                p_name: $('#product-name').val(),
                price: $('#price').val(),
                quantity: $('#quantity').val(),
                category: $('#category-id').val()
            };
            formData.append('product', new Blob([JSON.stringify(productData)], { type: 'application/json' }));

            $.ajax({
                url: '/products/save',
                type: 'POST',
                data: formData,
                processData: false,
                contentType: false,
                success: function () {
                    showNotification(); // Show notification box
                    $('form')[0].reset(); // Reset form after successful submission
                },
                error: function () {
                    alert('Error adding product.');
                }
            });
        });
    });
</script>
</body>
</html>
